# UniTrack 轨迹可视化分析系统

## 📖 简介

UniTrack 可视化工具是配套嵌入式系统的网页端轨迹分析平台，用于将 STM32 记录的 GPS+IMU 数据可视化展示在真实地图上。

## ✨ 功能特性

### 核心功能
- 🗺️ **地图轨迹显示** - 基于 Leaflet.js 的交互式地图
- 🎨 **速度热图** - 速度颜色编码（蓝→青→绿→黄→红）
- 📊 **统计分析** - 自动计算距离、速度、时长等指标
- 📈 **速度曲线图** - Chart.js 生成的实时速度变化图
- ▶️ **轨迹回放** - 动画方式回放运动过程
- 💾 **报告导出** - 生成文本格式分析报告

### 数据展示
- 总距离计算（Haversine 公式）
- 平均速度 / 最高速度
- 运动时长估算
- 海拔变化范围
- IMU 姿态数据（俯仰角、横滚角、偏航角）

## 🚀 使用方法

### 方法一：直接打开 HTML
1. 双击 `index.html` 文件
2. 浏览器自动打开可视化页面
3. 拖拽 CSV 文件到上传区域

### 方法二：本地服务器（推荐）
```bash
# Python 3
python -m http.server 8000

# Python 2
python -m SimpleHTTPServer 8000

# Node.js
npx http-server
```

然后访问: `http://localhost:8000`

## 📁 CSV 数据格式

### 标准格式
```csv
Time,Lat,LatDir,Lon,LonDir,Speed,Alt,Sats,Pitch,Roll,Yaw,Temp
14:23:45,32.123456,N,118.234567,E,45.2,100.5,8,2.3,-1.5,90.2,25.3
14:23:46,32.123567,N,118.234678,E,46.1,101.2,8,2.5,-1.3,90.5,25.4
```

### 字段说明
| 字段 | 说明 | 单位 | 示例 |
|------|------|------|------|
| Time | UTC 时间 | HH:MM:SS | 14:23:45 |
| Lat | 纬度数值 | 度 | 32.123456 |
| LatDir | 纬度方向 | N/S | N |
| Lon | 经度数值 | 度 | 118.234567 |
| LonDir | 经度方向 | E/W | E |
| Speed | 速度 | km/h | 45.2 |
| Alt | 海拔高度 | 米 | 100.5 |
| Sats | 卫星数量 | 个 | 8 |
| Pitch | 俯仰角 | 度 | 2.3 |
| Roll | 横滚角 | 度 | -1.5 |
| Yaw | 偏航角 | 度 | 90.2 |
| Temp | 温度 | ℃ | 25.3 |

## 🎮 操作指南

### 上传数据
- **拖拽上传**: 将 CSV 文件拖拽到上传区域
- **点击上传**: 点击上传区域选择文件

### 地图操作
- **缩放**: 鼠标滚轮 / 双击
- **平移**: 鼠标拖拽
- **查看详情**: 点击轨迹线段查看该点数据

### 控制按钮
- **轨迹回放** ▶️ - 动画播放运动过程
- **重置视图** 🔄 - 恢复到完整轨迹视图
- **导出报告** 💾 - 下载 TXT 格式分析报告

## 📊 数据统计说明

### 距离计算
使用 **Haversine 公式** 计算地球表面两点间的大圆距离：

```
d = 2R × arcsin(√(sin²(Δlat/2) + cos(lat1)×cos(lat2)×sin²(Δlon/2)))
```

其中 R = 6371 km（地球平均半径）

### 速度颜色映射
- 🔵 蓝色: 0-20% 最高速度
- 🔷 青色: 20-40%
- 🟢 绿色: 40-60%
- 🟡 黄色: 60-80%
- 🔴 红色: 80-100%

### 时长估算
假设每条记录间隔 1 秒（可根据实际采样率调整）

## 🛠️ 技术栈

- **地图引擎**: Leaflet.js 1.9.4
- **地图服务**: OpenStreetMap
- **图表库**: Chart.js 4.4.0
- **前端**: HTML5 + CSS3 + Vanilla JavaScript
- **数据处理**: 纯客户端，无需后端

## 🌐 浏览器兼容性

| 浏览器 | 最低版本 |
|--------|----------|
| Chrome | 90+ |
| Firefox | 88+ |
| Edge | 90+ |
| Safari | 14+ |

## 📝 示例数据

可以使用 STM32 设备记录的真实数据，或使用以下命令生成测试数据：

```bash
# 从 SD 卡读取文件
# 文件位置: 0:/data_000.csv, 0:/data_001.csv, ...
```

## ⚠️ 注意事项

1. **文件大小**: 建议单个 CSV 文件 < 5MB（约 50000 条记录）
2. **数据质量**: GPS 需至少 4 颗卫星定位才准确
3. **网络连接**: 首次加载需联网下载地图瓦片
4. **浏览器缓存**: 地图瓦片会缓存到本地，加速后续加载

## 🔧 自定义开发

### 修改采样间隔
修改 `updateStats()` 函数中的时长计算：

```javascript
// 假设每条记录间隔 2 秒
const durationSec = trackData.length * 2;
```

### 调整回放速度
修改 `btnPlayback` 事件中的间隔：

```javascript
const playbackInterval = 50; // 毫秒，值越小越快
```

### 更换地图源
替换 OpenStreetMap 为其他服务：

```javascript
// 高德地图
L.tileLayer('https://webrd01.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}')

// 天地图（需要申请 key）
L.tileLayer('http://t{s}.tianditu.gov.cn/DataServer?T=vec_w&x={x}&y={y}&l={z}&tk=YOUR_KEY', {
    subdomains: ['0', '1', '2', '3', '4', '5', '6', '7']
})
```

## 📧 问题反馈

如有问题或建议，请提交 Issue 到 GitHub 仓库。

## 📄 许可证

本项目仅用于学术研究和课程设计，未经许可不得商用。

---

**开发者**: XCMB-haochi
**更新时间**: 2025-01
**版本**: v1.0.0
